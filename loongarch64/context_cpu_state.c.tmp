/**
 * @file    context_cpu_state.c
 * @brief   LoongArch64上下文CPU状态管理
 * @author  Intewell Team
 * @date    2025-01-21
 * @version 1.0
 *
 * @details 本文件实现CPU状态的保存和恢复
 *          - 保存虚拟中断标志
 *          - 恢复虚拟中断状态
 *
 * @note MISRA-C:2012 合规
 *
 * @copyright Copyright (c) 2025 Intewell Team
 */

/************************头 文 件******************************/
#include <context.h>
#include <ttos.h>
#include <ttosInterHal.h>

/************************函数实现******************************/

/**
 * @brief 保存CPU状态到任务控制块
 *
 * @details 保存当前CPU的虚拟中断标志到任务控制块
 *          用于任务切换时保存CPU状态
 *
 * @param task 任务控制块指针（不能为NULL）
 * @param msr  机器状态值（包含虚拟中断标志）
 *
 * @return 无
 *
 * @note 此函数在任务切换时调用
 */
void arch_context_save_cpu_state(T_TTOS_TaskControlBlock *task, long msr)
{
    task->switchContext.vintflag = msr;
}

/**
 * @brief 从任务控制块恢复CPU状态
 *
 * @details 从任务控制块恢复虚拟中断标志
 *          用于任务切换后恢复CPU状态
 *
 * @param task 任务控制块指针（不能为NULL）
 *
 * @return 无
 *
 * @note 此函数在任务切换时调用
 */
void arch_context_restore_cpu_state(T_TTOS_TaskControlBlock *task)
{
    TBSP_GLOBALINT_ENABLE(task->switchContext.vintflag);
}
